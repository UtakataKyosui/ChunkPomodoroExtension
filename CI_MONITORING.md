# CI Monitoring and Auto-Fix System

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€GitHub Actionsã®CIã‚’è‡ªå‹•ç›£è¦–ã—ã€ä¸€èˆ¬çš„ãªãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’è‡ªå‹•ä¿®æ­£ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## æ©Ÿèƒ½

### ğŸ” CIç›£è¦–ãƒ»è‡ªå‹•ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`ci-monitor.sh`)
GitHub Actionsã®ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã—ã€ä¸€èˆ¬çš„ãªå•é¡Œã‚’ä¿®æ­£ã—ã¦ãƒªãƒˆãƒ©ã‚¤ã—ã¾ã™ã€‚

#### å¯¾å¿œã‚¨ãƒ©ãƒ¼
- **TailwindCSS PostCSSã‚¨ãƒ©ãƒ¼**: æ–°ã—ã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ§‹æˆã«è‡ªå‹•ä¿®æ­£
- **tsconfig.jsonä¸è¶³**: é©åˆ‡ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ç”Ÿæˆ
- **ã‚¢ã‚¤ã‚³ãƒ³/ã‚¢ã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼**: SVGã‚¢ã‚¤ã‚³ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆ
- **ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼**: Chromeæ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®šã‚’ä¿®æ­£
- **ä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼**: å‹å®šç¾©ã®è¿½åŠ 

### ğŸ› ï¸ CI ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`ci-utils.sh`)
GitHub Actionsã®çŠ¶æ…‹ç¢ºèªã¨ãƒ­ã‚°å–å¾—ã®ãŸã‚ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. è‡ªå‹•ç›£è¦–ãƒ»ä¿®æ­£
```bash
# CI ã‚’è‡ªå‹•ç›£è¦–ã—ã¦å¤±æ•—æ™‚ã«ä¿®æ­£ã‚’è©¦è¡Œ
npm run ci:monitor

# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
./scripts/ci-monitor.sh
```

### 2. CIçŠ¶æ…‹ç¢ºèª
```bash
# æœ€æ–°ã®CIå®Ÿè¡ŒçŠ¶æ³ã‚’ç¢ºèª
npm run ci:status

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§CIçŠ¶æ…‹ã‚’ç›£è¦–
npm run ci:watch

# ãƒ­ã‚°ã‚’å–å¾—
npm run ci:logs
```

### 3. æ‰‹å‹•ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```bash
# ç‰¹å®šã®Runã®ãƒ­ã‚°ã‚’å–å¾—
./scripts/ci-utils.sh get_logs 123456

# å®Ÿè¡Œä¸­ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
./scripts/ci-utils.sh cancel_runs

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
./scripts/ci-utils.sh trigger_workflow release.yml patch
```

## è‡ªå‹•ä¿®æ­£ã®æµã‚Œ

1. **ç›£è¦–é–‹å§‹**: æŒ‡å®šãƒ–ãƒ©ãƒ³ãƒã®æœ€æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚’ç›£è¦–
2. **å¤±æ•—æ¤œå‡º**: ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ãŸå ´åˆã€ãƒ­ã‚°ã‚’è‡ªå‹•å–å¾—
3. **ã‚¨ãƒ©ãƒ¼åˆ†æ**: ãƒ­ã‚°ã‹ã‚‰æ—¢çŸ¥ã®ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢
4. **è‡ªå‹•ä¿®æ­£**: æ¤œå‡ºã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã«å¯¾ã™ã‚‹ä¿®æ­£ã‚’é©ç”¨
5. **ã‚³ãƒŸãƒƒãƒˆ**: ä¿®æ­£ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒƒã‚·ãƒ¥
6. **ãƒªãƒˆãƒ©ã‚¤**: æ–°ã—ã„ãƒ“ãƒ«ãƒ‰ã‚’å¾…æ©Ÿã—ã¦çµæœã‚’ç¢ºèª
7. **ç¹°ã‚Šè¿”ã—**: æˆåŠŸã™ã‚‹ã¾ã§æœ€å¤§5å›ãƒªãƒˆãƒ©ã‚¤

## è¨­å®š

### ç’°å¢ƒå¤‰æ•°
ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã®è¨­å®šå€¤ã‚’å¤‰æ›´ã—ã¦å‹•ä½œã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ï¼š

```bash
# scripts/ci-monitor.sh
REPO_OWNER="UtakataKyosui"
REPO_NAME="ChunkPomodoroExtension"
BRANCH_NAME="build-to-zipfile-release"
MAX_RETRIES=5
```

### å¿…è¦ãªæ¨©é™
- GitHub CLI (`gh`) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ãƒªãƒã‚¸ãƒˆãƒªã¸ã®èª­ã¿å–ã‚Šãƒ»æ›¸ãè¾¼ã¿æ¨©é™
- GitHub Actionsã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™

## ä¾‹: å®Ÿéš›ã®ä½¿ç”¨ã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª1: PRä½œæˆå¾Œã®è‡ªå‹•ç›£è¦–
```bash
# PRã‚’ä½œæˆã—ãŸå¾Œã€CIã‚’ç›£è¦–é–‹å§‹
npm run ci:monitor

# å‡ºåŠ›ä¾‹:
# ğŸ” Starting CI Monitor for UtakataKyosui/ChunkPomodoroExtension...
# ğŸ”„ Attempt 1/5
# âŒ Build failed. Analyzing logs...
# âŒ Found TailwindCSS PostCSS plugin error
# ğŸ”§ Fixing TailwindCSS PostCSS configuration...
# âœ… TailwindCSS PostCSS configuration fixed
# ğŸ’¾ Committing fixes...
# âœ… Fixes pushed to build-to-zipfile-release
```

### ã‚·ãƒŠãƒªã‚ª2: CIçŠ¶æ…‹ã®å®šæœŸç¢ºèª
```bash
# 30ç§’é–“éš”ã§CIçŠ¶æ…‹ã‚’ç›£è¦–
npm run ci:watch

# ã¾ãŸã¯5åˆ†é–“éš”ã§ç›£è¦–
./scripts/ci-utils.sh watch 300
```

### ã‚·ãƒŠãƒªã‚ª3: ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèª
```bash
# æœ€æ–°ã®å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèª
npm run ci:logs

# ç‰¹å®šã®Run IDã®ãƒ­ã‚°ã‚’ç¢ºèª
./scripts/ci-utils.sh get_logs 123456789
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **GitHub CLIèªè¨¼ã‚¨ãƒ©ãƒ¼**
   ```bash
   gh auth login
   ```

2. **æ¨©é™ä¸è¶³ã‚¨ãƒ©ãƒ¼**
   - ãƒªãƒã‚¸ãƒˆãƒªã®`Settings > Actions > General`ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¨©é™ã‚’ç¢ºèª
   - Personal Access Tokenã®æ¨©é™ã‚’ç¢ºèª

3. **ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ¨©é™ã‚¨ãƒ©ãƒ¼**
   ```bash
   chmod +x scripts/*.sh
   ```

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ã«ã¯ï¼š
```bash
export DEBUG=1
./scripts/ci-monitor.sh
```

## æ‹¡å¼µ

æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ã€`scripts/ci-monitor.sh`ã®`analyze_and_fix`é–¢æ•°ã«æ¡ä»¶ã‚’è¿½åŠ ï¼š

```bash
# æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º
if echo "$logs" | grep -q "your-error-pattern"; then
    echo -e "${RED}âŒ Found your custom error${NC}"
    fix_your_custom_error
    fixes_applied=true
fi
```

å¯¾å¿œã™ã‚‹ä¿®æ­£é–¢æ•°ã‚‚è¿½åŠ ï¼š
```bash
fix_your_custom_error() {
    echo -e "${BLUE}ğŸ”§ Fixing your custom error...${NC}"
    # ä¿®æ­£å‡¦ç†
    echo -e "${GREEN}âœ… Your custom error fixed${NC}"
}
```